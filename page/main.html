<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div>
        <input type="file" name="img" id="file" value="选择文件">
        <button>上传</button>
        
        <a href="" download="" id="downloadImage">
            <img src="#" alt="" id="img" >
        </a>
    </div>
    <script>
        let button = document.getElementsByTagName("button")[0];
        button.addEventListener("click",function(){
               let file = document.getElementById("file").files[0];
               let form = new FormData();
               form.append("file",file);
               let xhr = new XMLHttpRequest();
               xhr.open("post","/upload",true);
               xhr.onload = ()=>{
                   alert("上传成功");
               }
               xhr.send(form);
               xhr.onreadystatechange = () =>{
                if(xhr.readyState == 4){
                    if(xhr.status == 200){
                        var data = xhr.responseText;
                        console.log(data);
                        alert("已收到");
                        document.getElementById("img").src = "/getPic?path="+data;
                        document.getElementById("downloadImage").href = "/getPic?path=" + data;
                        document.getElementById("downloadImage").download = "1.jpeg";
                    }
                }
            }

        },false) 
    </script>
</body>
</html>